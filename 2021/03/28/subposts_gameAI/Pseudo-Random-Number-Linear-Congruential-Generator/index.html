<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <title>Pseudo Random Number: Linear Congruential Generator | Alex&#39;s Epitaph</title>
  <meta name="keywords" content=" GameAI ">
  <meta name="description" content="Pseudo Random Number: Linear Congruential Generator | Alex&#39;s Epitaph">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="The wolf I will follow into the storm. To find your heart, its passion displaced. To dream of raven locks entwisted, stormy. Of violet eyes, glistening as you weep. ---Hardcore Headache">
<meta property="og:type" content="website">
<meta property="og:title" content="Alex&#39;s Epitaph">
<meta property="og:url" content="https://www.hellscript.cc/about/index.html">
<meta property="og:site_name" content="Alex&#39;s Epitaph">
<meta property="og:description" content="The wolf I will follow into the storm. To find your heart, its passion displaced. To dream of raven locks entwisted, stormy. Of violet eyes, glistening as you weep. ---Hardcore Headache">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2021-05-05T09:49:57.801Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Alex&#39;s Epitaph">
<meta name="twitter:description" content="The wolf I will follow into the storm. To find your heart, its passion displaced. To dream of raven locks entwisted, stormy. Of violet eyes, glistening as you weep. ---Hardcore Headache">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/gruvbox-light.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1"></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.0.1"></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value>
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg">
</a>
<div class="author">
    <span>Alex Zou</span>
</div>

<div class="icon">
    
        
        <a title="github" href="https://github.com/gzrjzcx" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"/>
                </svg>
            
        </a>
        
    
        
        <a title="email" href="mailto:gzrjzcx@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"/>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active">All<small>(42)</small></div></li>
    
        
            
            <li><div data-rel="DataStructure">DataStructure<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="C">C<small>(11)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="cppPrimer">cppPrimer<small>(13)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Interview">Interview<small>(9)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Life">Life<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Notes">Notes<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Parallel">Parallel<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Tools">Tools<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="GameAI">GameAI<small>(1)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url" href="/about">About</a><a style="width: 50%" class="friends">Friends</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="42">
<input type="hidden" id="yelog_site_word_count" value="48.9k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Link Exchange
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://www.hellscript.cc/Pointer2SSP/">Pointer2SSP</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode==13){return false;}">
        <input class="search" type="text" placeholder="Search..." autocomplete="off" id="local-search-input">
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none">
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">DataStructure</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">c</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">cpp</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Interview</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Life</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Notes</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">Parallel</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Tools</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">GameAI</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a class="Notes " href="/2021/05/02/subposts_notes/Using-GDB-to-debug/" data-tag="Notes" data-author>
            <span class="post-title" title="Using GDB to debug">Using GDB to debug</span>
            <span class="post-date" title="2021-05-02 20:55:55">2021/05/02</span>
        </a>
        
        <a class="Life " href="/2021/04/25/subposts_life/Star-And-Wish/" data-tag="Life" data-author>
            <span class="post-title" title="Star And Wish">Star And Wish</span>
            <span class="post-date" title="2021-04-25 14:22:29">2021/04/25</span>
        </a>
        
        <a class="GameAI " href="/2021/03/28/subposts_gameAI/Pseudo-Random-Number-Linear-Congruential-Generator/" data-tag="GameAI" data-author>
            <span class="post-title" title="Pseudo Random Number: Linear Congruential Generator">Pseudo Random Number: Linear Congruential Generator</span>
            <span class="post-date" title="2021-03-28 15:18:12">2021/03/28</span>
        </a>
        
        <a class="C " href="/2019/12/11/subposts_c/Memory-Dynamic-Allocation-for-2-d-Array/" data-tag="c" data-author>
            <span class="post-title" title="Memory Dynamic Allocation for 2-d Array">Memory Dynamic Allocation for 2-d Array</span>
            <span class="post-date" title="2019-12-11 16:37:49">2019/12/11</span>
        </a>
        
        <a class="cppPrimer " href="/2019/12/10/subposts_cppPrimer/CPN-3-6-2-d-Arrays/" data-tag="cpp" data-author>
            <span class="post-title" title="C++Primer 3-6: 2-d Arrays">C++Primer 3-6: 2-d Arrays</span>
            <span class="post-date" title="2019-12-10 12:47:52">2019/12/10</span>
        </a>
        
        <a class="cppPrimer " href="/2019/12/09/subposts_cppPrimer/CPN-3-5-1-C-style-character-string/" data-tag="cpp" data-author>
            <span class="post-title" title="C++Primer 3.5.1: C-style character string">C++Primer 3.5.1: C-style character string</span>
            <span class="post-date" title="2019-12-09 13:45:32">2019/12/09</span>
        </a>
        
        <a class="cppPrimer " href="/2019/12/08/subposts_cppPrimer/CPN-3-5-Array/" data-tag="cpp" data-author>
            <span class="post-title" title="C++Primer 3.5: Array">C++Primer 3.5: Array</span>
            <span class="post-date" title="2019-12-08 12:40:29">2019/12/08</span>
        </a>
        
        <a class="cppPrimer " href="/2019/11/29/subposts_cppPrimer/CPN-3-4-Iterator/" data-tag="cpp" data-author>
            <span class="post-title" title="C++Primer 3.4: Iterator">C++Primer 3.4: Iterator</span>
            <span class="post-date" title="2019-11-29 12:40:33">2019/11/29</span>
        </a>
        
        <a class="cppPrimer " href="/2019/11/25/subposts_cppPrimer/CPN-3-3-Vector/" data-tag="cpp" data-author>
            <span class="post-title" title="C++Primer 3.3: Vector">C++Primer 3.3: Vector</span>
            <span class="post-date" title="2019-11-25 16:00:53">2019/11/25</span>
        </a>
        
        <a class="cppPrimer " href="/2019/11/25/subposts_cppPrimer/CPN-3-2-Characters-in-String/" data-tag="cpp" data-author>
            <span class="post-title" title="C++Primer 3.2: Characters in String">C++Primer 3.2: Characters in String</span>
            <span class="post-date" title="2019-11-25 12:32:38">2019/11/25</span>
        </a>
        
        <a class="cppPrimer " href="/2019/11/24/subposts_cppPrimer/CPN-3-1-String/" data-tag="cpp" data-author>
            <span class="post-title" title="C++Primer 3.1: String">C++Primer 3.1: String</span>
            <span class="post-date" title="2019-11-24 13:19:35">2019/11/24</span>
        </a>
        
        <a class="cppPrimer " href="/2019/11/24/subposts_cppPrimer/CPN-2-6-Custom-Data-Structure/" data-tag="cpp" data-author>
            <span class="post-title" title="C++Primer 2.6: Custom Data Structure">C++Primer 2.6: Custom Data Structure</span>
            <span class="post-date" title="2019-11-24 12:04:25">2019/11/24</span>
        </a>
        
        <a class="cppPrimer " href="/2019/11/23/subposts_cppPrimer/CPN-2-5-Dealing-with-Types/" data-tag="cpp" data-author>
            <span class="post-title" title="C++Primer 2.5: Dealing with Types">C++Primer 2.5: Dealing with Types</span>
            <span class="post-date" title="2019-11-23 12:57:03">2019/11/23</span>
        </a>
        
        <a class="cppPrimer " href="/2019/11/19/subposts_cppPrimer/CPN-2-4-Const/" data-tag="cpp" data-author>
            <span class="post-title" title="C++Primer 2.4: Const">C++Primer 2.4: Const</span>
            <span class="post-date" title="2019-11-19 16:46:47">2019/11/19</span>
        </a>
        
        <a class="Interview " href="/2019/11/16/subposts_interview/Tencent-GameAI-First-Interview/" data-tag="Interview" data-author>
            <span class="post-title" title="Tencent GameAI First Interview">Tencent GameAI First Interview</span>
            <span class="post-date" title="2019-11-16 12:57:35">2019/11/16</span>
        </a>
        
        <a class="cppPrimer " href="/2019/11/12/subposts_cppPrimer/CPN-2-3-Compound-Types/" data-tag="cpp" data-author>
            <span class="post-title" title="C++Primer 2.3: Compound Types">C++Primer 2.3: Compound Types</span>
            <span class="post-date" title="2019-11-12 16:49:07">2019/11/12</span>
        </a>
        
        <a class="cppPrimer " href="/2019/11/12/subposts_cppPrimer/CPN-2-2-Variables/" data-tag="cpp" data-author>
            <span class="post-title" title="C++Primer 2.2: Variables">C++Primer 2.2: Variables</span>
            <span class="post-date" title="2019-11-12 14:21:29">2019/11/12</span>
        </a>
        
        <a class="cppPrimer " href="/2019/11/08/subposts_cppPrimer/CPN-2-1-Basic-Types/" data-tag="cpp" data-author>
            <span class="post-title" title="C++Primer 2.1: Basic Types">C++Primer 2.1: Basic Types</span>
            <span class="post-date" title="2019-11-08 10:25:41">2019/11/08</span>
        </a>
        
        <a class="Tools " href="/2019/11/03/subposts_tools/Gitalk-A-plugin-for-static-website/" data-tag="Tools" data-author>
            <span class="post-title" title="Gitalk: A plugin for static website">Gitalk: A plugin for static website</span>
            <span class="post-date" title="2019-11-03 15:59:20">2019/11/03</span>
        </a>
        
        <a class="Tools " href="/2019/11/03/subposts_tools/Travis-Automatically-build-and-deploy-to-github-pages/" data-tag="Tools" data-author>
            <span class="post-title" title="Travis: Automatically build and deploy to github pages">Travis: Automatically build and deploy to github pages</span>
            <span class="post-date" title="2019-11-03 11:29:19">2019/11/03</span>
        </a>
        
        <a class="Interview " href="/2019/11/01/subposts_interview/NetEasy-RL-Interview/" data-tag="Interview" data-author>
            <span class="post-title" title="NetEasy RL Interview">NetEasy RL Interview</span>
            <span class="post-date" title="2019-11-01 14:54:50">2019/11/01</span>
        </a>
        
        <a class="Interview " href="/2019/11/01/subposts_interview/ByteDance-Clinet-Developer-First-Interview/" data-tag="Interview" data-author>
            <span class="post-title" title="ByteDance: Clinet Developer First Interview">ByteDance: Clinet Developer First Interview</span>
            <span class="post-date" title="2019-11-01 11:06:19">2019/11/01</span>
        </a>
        
        <a class="DataStructure " href="/2019/10/30/Subposts_dataStructure/Data-Structure-Stack/" data-tag="DataStructure" data-author>
            <span class="post-title" title="Data Structure: Stack">Data Structure: Stack</span>
            <span class="post-date" title="2019-10-30 14:22:04">2019/10/30</span>
        </a>
        
        <a class="Interview " href="/2019/10/19/subposts_interview/Tencent-2019-campus-recruitment-Game-Developer-Engineer-first-interview/" data-tag="Interview" data-author>
            <span class="post-title" title="Tencent 2019 campus recruitment: Game Developer Engineer first interview">Tencent 2019 campus recruitment: Game Developer Engineer first interview</span>
            <span class="post-date" title="2019-10-19 20:47:44">2019/10/19</span>
        </a>
        
        <a class="Interview " href="/2019/10/16/subposts_interview/NetEasy-AI-Engineer-Interview/" data-tag="Interview" data-author>
            <span class="post-title" title="NetEasy AI Engineer Interview">NetEasy AI Engineer Interview</span>
            <span class="post-date" title="2019-10-16 12:08:30">2019/10/16</span>
        </a>
        
        <a class="C " href="/2019/10/04/subposts_c/scanf/" data-tag="c" data-author>
            <span class="post-title" title="scanf and its left white-space character problem">scanf and its left white-space character problem</span>
            <span class="post-date" title="2019-10-04 14:13:44">2019/10/04</span>
        </a>
        
        <a class="DataStructure " href="/2019/10/03/Subposts_dataStructure/LinkedList/" data-tag="DataStructure" data-author>
            <span class="post-title" title="Singly-Linked List">Singly-Linked List</span>
            <span class="post-date" title="2019-10-03 12:27:40">2019/10/03</span>
        </a>
        
        <a class="Interview " href="/2019/04/05/subposts_interview/OJ-IO/" data-tag="Interview" data-author>
            <span class="post-title" title="OJ IO">OJ IO</span>
            <span class="post-date" title="2019-04-05 22:34:12">2019/04/05</span>
        </a>
        
        <a class="Life " href="/2019/03/24/subposts_life/A-COOL-FISH/" data-tag="Life" data-author>
            <span class="post-title" title="A Cool Fish">A Cool Fish</span>
            <span class="post-date" title="2019-03-24 00:28:22">2019/03/24</span>
        </a>
        
        <a class="Interview " href="/2019/02/27/subposts_interview/Game-Categroy/" data-tag="Interview" data-author>
            <span class="post-title" title="Game Categroy">Game Categroy</span>
            <span class="post-date" title="2019-02-27 22:14:48">2019/02/27</span>
        </a>
        
        <a class="Interview " href="/2019/02/24/subposts_interview/Tencent-Timi/" data-tag="Interview" data-author>
            <span class="post-title" title="Tencent Timi Game engineer first interview">Tencent Timi Game engineer first interview</span>
            <span class="post-date" title="2019-02-24 13:49:58">2019/02/24</span>
        </a>
        
        <a class="C " href="/2019/02/23/subposts_c/struct-VS-class/" data-tag="c" data-author>
            <span class="post-title" title="struct VS. class">struct VS. class</span>
            <span class="post-date" title="2019-02-23 01:03:10">2019/02/23</span>
        </a>
        
        <a class="C " href="/2019/02/23/subposts_c/Typical-error-of-pointer/" data-tag="c" data-author>
            <span class="post-title" title="Typical error of pointer">Typical error of pointer</span>
            <span class="post-date" title="2019-02-23 00:15:35">2019/02/23</span>
        </a>
        
        <a class="C " href="/2019/02/23/subposts_c/dot-operator-Vs-arrow-operator/" data-tag="c" data-author>
            <span class="post-title" title="dot operator Vs. arrow operator">dot operator Vs. arrow operator</span>
            <span class="post-date" title="2019-02-23 00:11:13">2019/02/23</span>
        </a>
        
        <a class="C " href="/2019/02/22/subposts_c/pass-parameters-in-function/" data-tag="c" data-author>
            <span class="post-title" title="Pass parameters in function">Pass parameters in function</span>
            <span class="post-date" title="2019-02-22 23:57:46">2019/02/22</span>
        </a>
        
        <a class="C " href="/2019/02/22/subposts_c/reference-Vs-pointer/" data-tag="c" data-author>
            <span class="post-title" title="reference Vs. pointer">reference Vs. pointer</span>
            <span class="post-date" title="2019-02-22 23:44:05">2019/02/22</span>
        </a>
        
        <a class="C " href="/2019/02/22/subposts_c/c-preprocess/" data-tag="c" data-author>
            <span class="post-title" title="C preprocess">C preprocess</span>
            <span class="post-date" title="2019-02-22 23:23:13">2019/02/22</span>
        </a>
        
        <a class="C " href="/2019/02/22/subposts_c/charPointer-VS-charArray/" data-tag="c" data-author>
            <span class="post-title" title="char* VS char[]">char* VS char[]</span>
            <span class="post-date" title="2019-02-22 22:59:41">2019/02/22</span>
        </a>
        
        <a class="C " href="/2019/02/22/subposts_c/c-memory-layout/" data-tag="c" data-author>
            <span class="post-title" title="Static keyword &amp; C memory layout">Static keyword &amp; C memory layout</span>
            <span class="post-date" title="2019-02-22 21:54:33">2019/02/22</span>
        </a>
        
        <a class="C " href="/2019/02/22/subposts_c/The-nature-of-pointer/" data-tag="c" data-author>
            <span class="post-title" title="The nature of pointer">The nature of pointer</span>
            <span class="post-date" title="2019-02-22 13:37:59">2019/02/22</span>
        </a>
        
        <a class="Parallel " href="/2019/02/21/subposts_parallel/thread-vs-process/" data-tag="Parallel" data-author>
            <span class="post-title" title="thread Vs. process">thread Vs. process</span>
            <span class="post-date" title="2019-02-21 16:29:01">2019/02/21</span>
        </a>
        
        <a class="Interview " href="/2019/02/21/subposts_interview/switch_lamps/" data-tag="Interview" data-author>
            <span class="post-title" title="Turn on/off lamps">Turn on/off lamps</span>
            <span class="post-date" title="2019-02-21 00:26:09">2019/02/21</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-subposts_gameAI/Pseudo-Random-Number-Linear-Congruential-Generator" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Pseudo Random Number: Linear Congruential Generator</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a href="javascript:" data-rel="GameAI">GameAI</a>
            
        </span>
        
        
        <span class="tag">
            
            <a href="javascript:" class="color2">GameAI</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title="更新时间: 2021-05-05 09:49:57">2021-03-28 15:18</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:2.7k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#伪随机数：-线性同余法的应用"><span class="toc-text">伪随机数： 线性同余法的应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-背景"><span class="toc-text">1. 背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-线性同余法"><span class="toc-text">2. 线性同余法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-在每帧开始固定一个随机数种子"><span class="toc-text">3. 在每帧开始固定一个随机数种子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-对obj-id先做一次rand"><span class="toc-text">4. 对obj_id先做一次rand()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-每帧缓存不同obj-id的结果"><span class="toc-text">5. 每帧缓存不同obj_id的结果</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="伪随机数：-线性同余法的应用"><a href="#伪随机数：-线性同余法的应用" class="headerlink" title="伪随机数： 线性同余法的应用"></a>伪随机数： 线性同余法的应用</h1><h2 id="1-背景"><a href="#1-背景" class="headerlink" title="1. 背景"></a>1. 背景</h2><p>在传统游戏AI业务中，经常会用到随机数来避免机械化的行为。比如，以行为树（BehaviourDesigner）实现的AI需要使用到随机数来产生随机行为，从而避免重复动作，增加AI行为的多样性。同时，又因为帧同步的要求，需要保证在不同设备或者回放（重新跑帧逻辑）时产生的结果是一致的。所以，我们通常会选择伪随机数发生器来完成随机要求。</p>
<p>另外，在我们项目中，对于产生的伪随机数还有一些额外要求：</p>
<ol>
<li><p><strong>在同一帧内，不同AI个体产生的随机数结果要相互独立</strong>（i.e. 也就是A个体的随机结果和B个体的随机结果间不能存在某种关系）。这样可以避免多个AI走同一套AI逻辑时，如果所处环境很类似，会产生一样的行为的情况。视觉看上去这是多个AI出现了行为一致，很容易被看出来是AI。</p>
</li>
<li><p><strong>在同一帧内，同一AI个体多次调用随机数接口产生的随机数结果应该保持不变。</strong>这是因为我们的AI模块中会有难度设置，不同难度下需要通过一个随机概率来调节AI做出某种行为的概率。例如，低难度下AI做出进攻行为的条件应该是<code>A的攻击力(100)*调节概率(0.8) &gt; threshold</code>。此时的调节概率是随机出来的值，但是该节点可能会在一帧内执行多次，或者一帧内会有多个节点会使用到这个调节概率。所以，为了保持一帧内的结果一致，需要保证一帧内同一AI个体多次调用随机数接口时产生的结果一致。</p>
</li>
<li><p><strong>在不同帧内，同一AI个体产生的结果应该独立。这是最基本最常见的随机数的使用要求。</strong>一般来说，只要合理选择线性同余发生器的参数，则可以在其周期范围内认为其产生的结果是均匀的。</p>
</li>
</ol>
<h2 id="2-线性同余法"><a href="#2-线性同余法" class="headerlink" title="2. 线性同余法"></a>2. 线性同余法</h2><p>线性同余法应该是使用最多的伪随机数方法，如果能够选择合适的参数，对于一般的随机要求是足够的。其核心原理则是通过不断取模在一个模数范围内取得每次的值。只要模数足够大，且是满周期，则可以认为在这个模数范围内取得任一值的概率是相等的。其核心公式为：</p>
<p>$$X_n = (a*X_n-1 + c) % m$$.</p>
<p>这里我们从<a href="https://man7.org/linux/man-pages/man3/rand.3.html" target="_blank" rel="noopener">gcc</a>的实现上来看：</p>
<pre><code class="c">// 此套参数为 a = 1103515245, c = 12345, m = 32768
static unsigned long next = 1;

/* RAND_MAX assumed to be 32767 */
unsigned myrand(void) {
    next = next * 1103515245 + 12345; // 修改种子
    return((unsigned)(next/65536) % 32768); // 返回伪随机结果
}

void mysrand(unsigned int seed) {
    next = seed;
}
</code></pre>
<p>这里有几个值得注意的地方：</p>
<ul>
<li><p>在<code>myrand()</code>函数中，<code>next</code>表示的就是种子。这里每次调用该函数，会先修改此次随机行为的种子为<code>next * a + c</code>。但是按照线性同余法原本的定义，下一次随机的种子应该为<code>(next * a + ) % m</code>，但是在gcc的实现中利用了整数的溢出规则，让其超过整形限制时自动实现取模操作。这种方法在滚哈希的时候常用，理论上会比手动取摸更快（寄存器自然操作）。</p>
</li>
<li><p>在计算随机结果的时候，先对种子进行了<code>next/65536</code>的操作，这一步为了抛弃低位数字。因为高位数字比低位数字具有更长的周期，所以这样会产生更均匀的随机数。</p>
<blockquote>
<p> As shown above, LCGs do not always use all of the bits in the values they produce. For example, the <a href="https://en.wikipedia.org/wiki/Java_(programming_language" target="_blank" rel="noopener">Java</a>) implementation operates with 48-bit values at each iteration but returns only their 32 most significant bits. This is because the higher-order bits have longer periods than the lower-order bits (see below). LCGs that use this truncation technique produce statistically better values than those that do not. This is especially noticeable in scripts that use the mod operation to reduce range; modifying the random number mod 2 will lead to alternating 0 and 1 without truncation. </p>
<p>​                                                                                                                                    —- <a href="https://en.wikipedia.org/wiki/Linear_congruential_generator" target="_blank" rel="noopener">wiki</a></p>
</blockquote>
</li>
</ul>
<p>简单总结，每次调用<code>myrand()</code>函数，都会经历一次修改种子，计算随机结果的操作。只要这样不断更新种子，才能保证取到的伪随机数是真正在周期范围内（m内）只均匀出现过一次的数。很显然，传统的LCGs是不能满足我们对于随机数的要求1和要求2，（要求3天然满足）。因此，我们需要对LCGs进行修改。</p>
<h2 id="3-在每帧开始固定一个随机数种子"><a href="#3-在每帧开始固定一个随机数种子" class="headerlink" title="3. 在每帧开始固定一个随机数种子"></a>3. 在每帧开始固定一个随机数种子</h2><p>我们最开始的想法，是在每帧开始前先固定一个随机数种子，然后对于不同的角色，根据其id对种子做偏移以取得不同的结果。代码如下：</p>
<pre><code class="c">static unsigned long seed = 1;

// 一帧内不同英雄都可能多次调用此函数
unsigned myrand(){
    if(curFrame != GetFrame()){
        seed = seed * 1103515245 + 12345;
        curFrame = GetFrame();
    }
    rand(obj_id);
}

unsigned rand(void, obj_id) {
    // 往下在取一次种子，同时使用playerId区别不同角色随机的结果
    unsigned long nextSeed = (seed + obj_id) * 1103515245 + 12345; 
    return((unsigned)(nextSeed/65536) % 32768); // 返回伪随机结果
}
</code></pre>
<p>从代码中可以看到，此时会在每一帧开始时先固定一个种子，然后对于不同的<code>obj_id</code>，在该种子的基础上往后取一次种子，同时以该id作为偏移量。咋一看这样确实满足了背景上的三个条件，但是其实存在问题。在LCGs中，<strong>如果种子固定，那么在该种子上作偏移，始终是存在一定的线性关系</strong>。举个例子，如果此时<code>myrand(playerId = 1)</code>的结果为28，那么<code>myrand(playerId = 2)</code>的结果大概率为大于28的随机数（说大概率是因为可能存在溢出的情况）。具体可以看下图：</p>
<p><img src="/res/gameAI/randomNumber/rand_with_offset.png" alt="rand_with_offset"></p>
<p>该图中所使用的的参数为：<code>a = 7, c = 7, m = 10, s0 = 7,</code>从图中可以看出，<code>obj_id = 4</code>和<code>obj_id = 11</code>明显有着同样的“距离”。也就是说，在同一帧中，不同的玩家，随机到的结果却是始终出现了类似的结果。如果体现在AI上，就是不同的AI个体，但是在随机做一些动作时，总是会随到同样的动作。或者随机往某个方向移动时，总是会随机到类似的方向。这就导致AI的拟人化很差，人类玩家一样就能看出来AI。</p>
<p>这个结果其实也很容易推论出来，根据LCGs的公式：<code>(a*(s+o)+c)%m  -&gt; ((a*s+c)%m + (a*o)%m)%m</code>，当s固定时，左侧加数其实是一个常数，也就是只有<code>(a*o)%m</code>在变化，当<code>a*o</code>小于m时这其实就是条直线，大于m后就溢出重来。 我们可以画一个更极端的图来验证：</p>
<p><img src="/res/gameAI/randomNumber/different_obj_id.png" alt="rand_with_offset"></p>
<p>该图为固定一个种子后，<code>obj_id</code>（x轴）从0不断增大，随机值（y轴）的变化。可以看到，随着<code>obj_id</code>的增大，其值总是在不断增加，然后溢出重来。这就导致对种子进行偏移来区分不同对象以取得不同随机数的方法是不对的，因为他们取到的值并不是均匀的， 而是具有一定的差值。此时并不满足我们背景里的要求1，即不同角色取到的随机数并不是独立的，而是存在一定差值。</p>
<h2 id="4-对obj-id先做一次rand"><a href="#4-对obj-id先做一次rand" class="headerlink" title="4. 对obj_id先做一次rand()"></a>4. 对<code>obj_id</code>先做一次rand()</h2><p>上述方法并不满足我们的3个要求，因为当<code>obj_id</code>一定时，以其作为偏移量，得到的随机结果也总是有一定的偏移量。所以，我们可以先对<code>obj_id</code>取一次随机，然后将得到的结果作为偏移量。</p>
<pre><code class="c">static unsigned long seed = 1;

// 一帧内不同英雄都可能多次调用此函数
unsigned myrand(){
    if(curFrame != GetFrame()){
        seed = seed * 1103515245 + 12345;
        curFrame = GetFrame();
    }
    int result = rand(rand(obj_id));
}

unsigned rand(int offset) {
    unsigned long nextSeed = (seed + offset) * 1103515245 + 12345; 
    return((unsigned)(nextSeed/65536) % 32768); // 返回伪随机结果
}
</code></pre>
<p>这样其实也是和上面的方法存在一样的问题。因为第一次rand的时候，得到的<code>offset</code>其实也是存在一定的差值的，所以第二次rand这个差值并不会消失。</p>
<h2 id="5-每帧缓存不同obj-id的结果"><a href="#5-每帧缓存不同obj-id的结果" class="headerlink" title="5. 每帧缓存不同obj_id的结果"></a>5. 每帧缓存不同<code>obj_id</code>的结果</h2><p>根据上面的分析，可以知道其实只有在LCGs的迭代公式上才能获得均匀的伪随机数，如果固定种子做偏移是不行的。所以，为了满足上面三个条件，可以有一种方法：将<code>obj_id</code>看作是执行rand的次数，而不是在种子上做偏移。比如<code>rand(5)</code>则表示调用5次rand函数，也就是在迭代公式上走了5次，返回的当然还是随机的结果。这样的做法，对于每帧内不同的<code>obj_id</code>，返回的肯定是独立的结果。并且，每帧内由于基<code>seed</code>并不会改变，所以同一个<code>obj_id</code>多次调用，返回的也是同样的结果。即满足上述的所有三个条件。</p>
<p>但是这样会有大量的浪费（如果<code>obj_id</code>很大）。所以，有一个折中的方法为：如果<code>obj_id</code>的数量不是很多的话，例如固定100个，那么可以用一个字典来缓存每帧内的随机结果：</p>
<pre><code class="c">static unsigned long seed = 1;
dictionary &lt;int, int&gt;* randomResults;

// 一帧内不同英雄都可能多次调用此函数
unsigned myrand(){
    if(curFrame != GetFrame()){
        randomResults-&gt;clear();
        curFrame = GetFrame();
    }
    unsigned result = rand(rand(obj_id));
}

unsigned rand(int obj_id) {
    unsigned result = 0;
    if (!randomReuslts-&gt;tryGetValue(obj_id, &amp;result)){
        seed = (seed + offset) * 1103515245 + 12345; 
        unsigned result = (unsigned)(seed/65536) % 32768);
        randomResults-&gt;Insert(obj_id, result);
    }
    return result
}
</code></pre>
<p>从代码里可以看出，同一帧内并不是固定一个<code>seed</code>，而是每次调用到<code>rand</code>函数都会更新<code>seed</code>，但是在刚进入到新一帧时，会先清空缓存的字典。然后每一个不同的<code>obj_id</code>，都会作为key存入字典中。也就是说，后续如果有相同的<code>obj_id</code>再次调用rand函数，则不会真正的再去取一次随机数，而是从缓存里得到该帧内第一次随机得到的结果。也就是满足了是三个条件中的条件2。同时，因为此时并没有在固定种子上做偏移，而是和LCGs的常规用法一样，每次调用都会更新种子，所以返回的也是均匀的伪随机数，所以满足了条件1。条件3则是天然满足。</p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 gzrjzcx@qq.com </span>
    </div>
</article>


<p>
    <a href="javascript:void(0)" class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>Pseudo Random Number: Linear Congruential Generator</p>
    <p><span class="copy-title">文章字数:</span><span class="post-count">2.7k</span></p>
    <p><span class="copy-title">本文作者:</span><a href="javascript:void(0)" title="Alex Zou">Alex Zou</a></p>
    <p><span class="copy-title">发布时间:</span>2021-03-28, 15:18:12</p>
    <p><span class="copy-title">最后更新:</span>2021-05-05, 09:49:57</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2021/03/28/subposts_gameAI/Pseudo-Random-Number-Linear-Congruential-Generator/" title="Pseudo Random Number: Linear Congruential Generator">https://www.hellscript.cc/2021/03/28/subposts_gameAI/Pseudo-Random-Number-Linear-Congruential-Generator/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target="_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>



    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script type="text/javascript" src="https://raw.githack.com/gzrjzcx/Pointer2SSP/src/md5.min.js"></script>

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: 'ace8b1a7e41a82bdec9c',
            clientSecret: '7319499a5d48752ac975d60e50caf6c22b38ea20',
            repo: 'gzrjzcx.github.io',
            owner: 'gzrjzcx',
            admin: ['gzrjzcx'],
            id: md5(decodeURI(location.pathname)),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2016-2019 AlexZou</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class id="rocket" href="javascript:void(0)"></a>
    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>有钱的捧个钱场，没钱的借钱也捧个钱场</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.png" class="alipay" title="扫码支持">
            <img src="/img/wechat.png" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">Alipay</label></span><span><label><input type="radio" name="pay" value="weixin">Wechat</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.0.1"></script>

<script src="/js/script.js?v=1.0.1"></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#DataStructure','#c','#cpp','#Interview','#Life','#Notes','#Parallel','#Tools','#GameAI',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: ;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://raw.githubusercontent.com/gzrjzcx/AlexsImageHosting/master/images/2019-11-21-16-56-44-bg_blog5.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
