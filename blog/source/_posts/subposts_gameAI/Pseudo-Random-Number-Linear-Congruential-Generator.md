---
title: 'Pseudo Random Number: Linear Congruential Generator'
date: 2021-03-28 15:18:12
categories: GameAI
tags: GameAI
hide: true
---

# 伪随机数： 线性同余法的应用

## 1. 背景

在传统游戏AI业务中，经常会用到随机数来避免机械化的行为。比如，以行为树（BehaviourDesigner）实现的AI需要使用到随机数来产生随机行为，从而避免重复动作，增加AI行为的多样性。同时，又因为帧同步的要求，需要保证在不同设备或者回放（重新跑帧逻辑）时产生的结果是一致的。所以，我们通常会选择伪随机数发生器来完成随机要求。

另外，在我们项目中，对于产生的伪随机数还有一些额外要求：

1. 在同一帧内，不同AI个体产生的随机数结果要相互独立（i.e. 也就是A个体的随机结果和B个体的随机结果间不能存在某种关系）。这样可以避免多个AI走同一套AI逻辑时，如果所处环境很类似，会产生一样的行为的情况。视觉看上去这是多个AI出现了行为一致，很容易被看出来是AI。
2. 在同一帧内，同一AI个体多次调用随机数接口产生的随机数结果应该保持不变。这是因为我们的AI模块中会有难度设置，不同难度下需要通过一个随机概率来调节AI做出某种行为的概率。例如，低难度下AI做出进攻行为的条件应该是$A的攻击力(100)*调节概率(0.8) > threshold$。此时的调节概率是随机出来的值，但是该节点可能会在一帧内执行多次，或者一帧内会有多个节点会使用到这个调节概率。所以，为了保持一帧内的结果一致，需要保证一帧内同一AI个体多次调用随机数接口时产生的结果一致。
3. 在不同帧内，同一AI个体产生的结果应该独立。这是最基本最常见的随机数的使用要求。一般来说，只要合理选择线性同余发生器的参数，则可以在其周期范围内认为其产生的结果是均匀的。

## 2. 线性同余法

线性同余法应该是使用最多的伪随机数方法，如果能够选择合适的参数，对于一般的随机要求是足够的。其核心原理则是通过不断取模在一个模数范围内取得每次的值。只要模数足够大，且是满周期，则可以认为在这个模数范围内取得任一值的概率是相等的。其核心公式为：

$$X_n = (a*X_n-1 + c) % m$$.

这里我们从gcc的实现上来看：



